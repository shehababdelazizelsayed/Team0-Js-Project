<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout</title>
    <link rel="stylesheet" href="checkout.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="topbar_style.css" />
  </head>
  <body>
    <div class="main-Conatiner">
      <div class="Top-Bar">
        <img
          src="./Assets/logo.jpg"
          class="logo"
          alt="Company Logo"
          onclick="window.location.href='index.html'"
        />

        <div class="search">
          <input
            type="text"
            name="Search-bar"
            placeholder="Search..."
            class="searchbox"
          />
          <button type="submit" class="search-icon">
            <i class="fa fa-search"></i>
          </button>
        </div>

        <div class="icon-group">
          <div class="wrapper profile-wrapper">
            <button
              type="button"
              class="profile-icon"
              id="profileBtn"
              aria-label="Profile"
              title="Profile"
            >
              <i class="fa fa-user" style="font-size: 28px"></i>
            </button>
            <div class="profile-dropdown" id="profileDropdown">
              <p class="profile-email">None</p>
              <br />
              <a href="profile.html">My Profile</a><br />
              <button
                id="logoutBtn"
                style="
                  background: none;
                  border: none;
                  color: #1c2a33;
                  cursor: pointer;
                  padding: 0;
                  margin: 0;
                  text-align: center;
                  width: 100%;
                "
              >
                Logout
              </button>
            </div>
          </div>
          <button
            type="button"
            class="profile-icon"
            aria-label="Go to cart"
            title="Cart"
            id="cartBtn"
          >
            <i class="fa fa-shopping-cart" style="font-size: 22px"></i>
            <span id="cartCount" class="cart-count">0</span>
          </button>
        </div>

        <div class="button-container">
          <div class="wrapper">
            <button class="contact-btn" id="emailBtn">
              <i class="fa fa-envelope"></i>
            </button>
            <div class="contact-box" id="emailBox">
              Shehab200088111@gmail.com
            </div>
          </div>

          <div class="wrapper">
            <button class="contact-btn" id="phoneBtn">
              <i class="fa fa-phone"></i>
            </button>
            <div class="contact-box" id="phoneBox">+201023323888</div>
          </div>
        </div>
      </div>

      <h1 class="Header">Checkout</h1>

      <div class="checkout-box">
        <h2>Address</h2>
        <form class="address-form">
          <input type="text" placeholder="Country" />
          <input type="text" placeholder="City" />
          <input type="text" placeholder="Address line 1" />
          <input type="text" placeholder="Address line 2" />
        </form>
      </div>

      <table class="cart-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Product name</th>
            <th>Model</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total Price</th>
          </tr>
        </thead>
        <tbody id="checkoutTableBody">
          <!-- Cart items will be loaded dynamically -->
        </tbody>
      </table>

      <div class="totals-box">
        <p>Total product price: <span>$300</span></p>
        <p>Shipment: <span>$20</span></p>
        <p>
          <strong>Required to pay: <span>$320</span></strong>
        </p>
      </div>

      <div class="checkout-box">
        <h2>Payment Method</h2>
        <form
          class="payment-methods"
          role="radiogroup"
          aria-label="Payment Method"
        >
          <div class="payment-option">
            <input
              type="radio"
              id="pay-cod"
              name="payment"
              value="cod"
              checked
            />
            <label for="pay-cod">Cash on Delivery</label>
          </div>
          <div class="payment-option">
            <input type="radio" id="pay-card" name="payment" value="card" />
            <label for="pay-card">Card</label>
          </div>
        </form>
      </div>

      <div class="checkout-box">
        <h2>Comments</h2>
        <textarea placeholder="Any notes about delivery..."></textarea>
      </div>

      <div class="confirm-order">
        <button class="confirm-btn">Confirm Order</button>
      </div>

      <div class="footer">
        <div class="feet-contact">
          <ul class="foot-contact">
            <li class="focus">Contact</li>
            <li>Email: Shehab200088111@gmail.com</li>
            <li>Phone number: +201023323888</li>
          </ul>
        </div>
        <div class="feet-tags">
          <ul class="foot-tags">
            <li class="focus">Tags</li>
            <li>Mother board</li>
            <li>CPU</li>
            <li>GPU</li>
            <li>RAM</li>
            <li>Power supply</li>
            <li>Hard Drives</li>
            <li>Accessories</li>
          </ul>
        </div>
        <div class="feet-pages">
          <ul class="foot-pages">
            <li class="focus">Pages</li>
            <li><a href="#">Feedback</a></li>
            <li><a href="#">About</a></li>
          </ul>
        </div>
      </div>
      <div class="Copywrite">&copy; 2025 Team 0. All rights reserved.</div>
    </div>
    <script src="https://www.paypal.com/sdk/js?client-id=AQdbt8wKmeJbBuyYF4XVn8RKlR96Cdw2jEu808JQ6xGf9S-H6PZx1BevZlaX5FE89RW-o2lXK69qtMqh"></script>
    <script src="checkout.js"></script>
    <script src="./topbar_js.js"></script>
    <script type="module">
      document.addEventListener("DOMContentLoaded", () => {
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", async () => {
            try {
              await auth.signOut();
              window.location.href = "login.html";
            } catch (err) {
              console.error("Error signing out:", err);
            }
          });
        }

        document.addEventListener("click", function (event) {
          if (!event.target.closest(".profile-wrapper")) {
            document
              .getElementById("profileDropdown")
              .classList.remove("active");
          }
        });
      });

      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
      import {
        getAuth,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyD9ghRnC-TMJ-TV6TJxdGH_7qgRsT6Po04",
        authDomain: "project-d6110.firebaseapp.com",
        projectId: "project-d6110",
        storageBucket: "project-d6110.firebasestorage.app",
        messagingSenderId: "402041654228",
        appId: "1:402041654228:web:2430f53e2afb775e242441",
        measurementId: "G-0ZLPYLVJ4Y",
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      function updateProfileDropdown(user) {
        const dropdown = document.getElementById("profileDropdown");
        if (!dropdown) return;
        let emailElem = dropdown.querySelector(".profile-email");
        if (!emailElem) {
          emailElem = document.createElement("p");
          emailElem.className = "profile-email";
          dropdown.prepend(emailElem);
        }
        if (user && user.email) {
          emailElem.textContent = user.email;
          dropdown.querySelector("a[href='profile.html']").style.display = "";
          const logoutBtn = dropdown.querySelector("#logoutBtn");
          if (logoutBtn) logoutBtn.style.display = "";
          if (dropdown.querySelector(".login-link")) {
            dropdown.querySelector(".login-link").remove();
          }
        } else {
          emailElem.textContent = "Not logged in";
          dropdown.querySelector("a[href='profile.html']").style.display =
            "none";
          const logoutBtn = dropdown.querySelector("#logoutBtn");
          if (logoutBtn) logoutBtn.style.display = "none";
          if (!dropdown.querySelector(".login-link")) {
            const loginLink = document.createElement("a");
            loginLink.href = "login.html";
            loginLink.textContent = "Login";
            loginLink.className = "login-link";
            loginLink.style.display = "block";
            dropdown.appendChild(loginLink);
          }
        }
      }

      const auth = getAuth(app);
      window.currentUser = null;
      onAuthStateChanged(auth, (user) => {
        window.currentUser = user;
        updateProfileDropdown(user);
      });

      document
        .getElementById("profileBtn")
        .addEventListener("click", function (e) {
          if (!window.currentUser) {
            window.location.href = "login.html";
            return;
          }
          e.stopPropagation();
          document.getElementById("profileDropdown").classList.toggle("active");
        });
    </script>
  </body>
</html>
